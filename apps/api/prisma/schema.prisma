generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(uuid())
  name      String?
  createdAt DateTime @default(now())

  settings     Settings?
  sprints      Sprint[]
  chatMessages ChatMessage[]
}

model Settings {
  id           String   @id @default(uuid())
  userId       String   @unique
  timezone     String   @default("America/Sao_Paulo")
  reminderTime String   @default("09:00") // HH:mm
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Sprint {
  id        String   @id @default(uuid())
  userId    String
  name      String
  objective String   // Objetivo original do usuario
  deadline  String?  // YYYY-MM-DD ou null
  totalDays Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  days        SprintDay[]
  chatHistory ChatMessage[]
}

model SprintDay {
  id            String    @id @default(uuid())
  sprintId      String
  dayNumber     Int
  title         String
  description   String
  tasks         String    @default("[]") // JSON: [{title, minutes, done}]
  resources     String    @default("[]") // JSON: [{title, url}]
  quizQuestions String    @default("[]") // JSON: [{question, options, correct}]
  completedAt   DateTime?
  quizScore     Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  sprint Sprint @relation(fields: [sprintId], references: [id], onDelete: Cascade)

  @@unique([sprintId, dayNumber])
}

model ChatMessage {
  id        String   @id @default(uuid())
  sprintId  String?
  userId    String
  role      String   // "user" | "assistant"
  content   String
  createdAt DateTime @default(now())

  sprint Sprint? @relation(fields: [sprintId], references: [id], onDelete: Cascade)
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}
